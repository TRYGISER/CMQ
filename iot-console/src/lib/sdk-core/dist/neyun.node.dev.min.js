!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.NEYUN=r():e.NEYUN=r()}("undefined"!=typeof self?self:this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=0)}([function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=t(1);Object.defineProperty(r,"Service",{enumerable:!0,get:function(){return n(o).default}});var i=t(2);Object.defineProperty(r,"createAPI",{enumerable:!0,get:function(){return n(i).default}})},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),i=function(){function e(r,t,o){if(n(this,e),!r)throw new Error("serverName is must");if(!t)throw new Error("request is must");this.serverName=r,this.request=t,this.$env={},o&&(this.apis=o,this.$config(Object.keys(o),o))}return o(e,[{key:"$requestWrap",value:function(e,r){var t=void 0;if(r.check&&!1===r.check(e))throw new Error("check data error",e);return r.mock&&(t=r.mock(e)),t&&t.then?t:this.request(e)}},{key:"$config",value:function(e,r){var t=this;r=r||this.apis;var n=Array.isArray(e)?e:Object.keys(e);if(!r)throw new Error("apis is required");return n.forEach(function(n){var o=t;(Array.isArray(e)?e.includes(n):!0===e[n])?t[n]=function e(t){var i=r[n];if(!i)throw new Error("no such api, check api config");return o.$requestWrap(i.init(this)(t),e)}:t[n]=e[n]}),this}},{key:"$setENV",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return["region","AK","SK"].forEach(function(t){if(!r[t]&&!e.$env[t])throw new Error(t+" is required")}),r.host||this.$env.host||console.warn("host can set in here or set in data.headers"),Object.assign(this.$env,r),this}},{key:"$set",value:function(e,r){return this.$env[e]=r,this}},{key:"$get",value:function(e){return this.$env[e]}}]),e}();r.default=i},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){var t={};return Object.keys(e).forEach(function(n){t[n]=new l(e[n],r)}),e={},t}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();r.default=o;var u=t(3),a=t(4),s=new a,c=["query","path","body","response"],f=(t(5),t(6),t(7)),h=t(8),d=["PATCH","POST","PUT"],l=function(){function e(r,t){var o=this;n(this,e);var i=r.url;this.sign=r.sign,this.url=i.path,this.serverName=t,this.query=i.query,this.method=i.method.toUpperCase(),this.headers=r.headers,this.config=r.config,this.body=r.body,c.forEach(function(e){r[e]&&("response"!==e?o[e+"Schema"]=s.compile(r[e]):Object.keys(r[e]).forEach(function(t){o["req"+t]=s.compile(r[e][t])}))})}return i(e,[{key:"init",value:function(e){var r=this;return function(t){var n=e.$env,o=r.method;t=t||{},c.forEach(function(e){var n=t[e],i=r[e+"Schema"];if(i&&!i(n)){var u="["+o+"] "+r.url+" "+e+" params is error.\n"+JSON.stringify(i.errors,null,"\t");throw new Error(u)}});var i=r.url,a=t.path;a&&(i=(0,u.resolvePath)(i,a));var s=t.query;s||Object.keys(t).forEach(function(e){var r=t[e];["headers","config","body","path"].includes(e)||(s[e]=r)});var l=Object.assign({},r.query,s),p=Object.assign({},r.headers,t.headers),y=Object.assign({},r.config,t.config),v="";if(d.includes(o)&&(v=Array.isArray(t.body)?t.body:Object.assign({},r.body,t.body)||v),r.sign){if(!p.host&&!n.host)throw new Error("host is required if you want to sign");p.host=p.host||f.parse(n.host).host,h.sign(n.region,n.AK,n.SK,o,r.url,r.serverName,l,p,v)}return i=(0,u.concatURL)(i,l),{url:i,body:v,headers:p,method:o,config:y,query:l,path:a}}}}]),e}()},function(e,r,t){"use strict";function n(e){return"string"==typeof e}function o(e){return-1!==Object.prototype.toString.call(e).indexOf("Object")}function i(e,r){var t="";return t=n(r)?r:o(r)?a(r):(r||"").toString(),t&&(e+=(-1===e.indexOf("?")?"?":"&")+t),e}function u(e,r){return e&&o(r)?e.replace(/\{(.*?)\}/g,function(e,t){return r[t]||e}):e}Object.defineProperty(r,"__esModule",{value:!0}),r.isString=n,r.isObject=o,r.concatURL=i,r.resolvePath=u;var a=function(e){return Object.keys(e).map(function(r){return encodeURIComponent(r)+"="+encodeURIComponent(e[r])}).join("&")}},function(e,r){e.exports=require("ajv")},function(e,r){e.exports=require("json-schema-faker/lib/index.js")},function(e,r){e.exports=require("request")},function(e,r){e.exports=require("url")},function(e,r,t){"use strict";function n(e,r,t,n,o,i,a,s,f){var g=[];g.push(n),g.push(o),d(s),g.push(c(a));var b=(new Date).toISOString().split(".")[0]+"Z",O=b.split("T")[0].replace(/-/g,""),w=O+"/"+e+"/"+i+"/163_request",S=h(b,!0);Object.assign(s,S);var k=y(s);g.push(l(s)),g.push(k),g.push(v(JSON.stringify(f)));var q=[u.signatureMethod,b,w,p(g.join("\n")).toLowerCase()].join("\n"),E=j(t,e,O,i);s.Authorization=u.signatureMethod+" Credential="+r+"/"+w+", SignedHeaders="+k+", Signature="+m(q,E)}Object.defineProperty(r,"__esModule",{value:!0}),r.sign=n;var o=t(9),i=function(e){return e&&e.__esModule?e:{default:e}}(o),u={signatureMethod:"HMAC-SHA256",hash:"sha256"},a=new Set(["X-163-SignedHeaders","X-163-Signature","Authorization"]),s=new Set([].concat(function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(a),["X-163-Date","X-163-Credential","X-163-SignatureVersion","X-163-SignatureMethod","X-163-SignatureNonce","X-163-DryRun"])),c=function(e){return Object.keys(e).sort().map(function(r){return encodeURIComponent(r)+"="+encodeURIComponent(e[r])}).join("&")},f=function(e,r){for(r=e="";e++<36;r+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return r},h=function(e){return{"X-163-Date":e,"X-163-SignatureVersion":"2.0","X-163-SignatureNonce":f().replace(/-/,"")}},d=function(e){Object.keys(e).forEach(function(r){s.has(r)&&delete e[r]})},l=function(e){return Object.keys(e).sort().map(function(r){return r.toLowerCase()+":"+(e[r]||"")}).join("\n")+"\n"},p=function(e){var r=i.default.createHash(u.hash);return r.update(e),r.digest("hex")},y=function(e){var r=[];return Object.keys(e).forEach(function(e){a.has(e)||r.push(e.toLowerCase())}),r.sort().join(";")},v=function(e){return p(e).toLowerCase()},g=function(e,r){return i.default.createHmac("sha256",e).update(r,"utf8").digest()},b=function(e,r){return i.default.createHmac("sha256",e).update(r,"utf8").digest("hex")},j=function(e,r,t,n){return g(g(g(g(Buffer.from("163"+e),t),r),n),"163_request")},m=function(e,r){return b(r,e)}},function(e,r){e.exports=require("crypto")}])});